====================================
User Suspension System - Complete Guide
ì‚¬ìš©ì ì´ìš© ì •ì§€ ê´€ë¦¬ ì‹œìŠ¤í…œ
====================================

âœ… COMPLETE! User suspension management system created.

====================================
ğŸ“‹ SYSTEM OVERVIEW
====================================

Purpose:
ì‚¬ìš©ìì˜ ì„œë¹„ìŠ¤ ì´ìš©ì„ ì œí•œí•˜ê±°ë‚˜ ì°¨ë‹¨í•˜ëŠ” ì‹œìŠ¤í…œ

Use Cases:
- ì•½ê´€ ìœ„ë°˜ ì‚¬ìš©ì ì°¨ë‹¨
- ë¶€ì • í–‰ìœ„ ë°©ì§€
- ê²°ì œ ë¬¸ì œ ì‚¬ìš©ì ì œí•œ
- ë³´ì•ˆ ì´ìŠˆ ëŒ€ì‘
- ì„ì‹œ/ì˜êµ¬ ì •ì§€

====================================
ğŸš« SUSPENSION TYPES
====================================

1ï¸âƒ£ account - ê³„ì • ì™„ì „ ì°¨ë‹¨
   - ë¡œê·¸ì¸ ë¶ˆê°€
   - ëª¨ë“  ê¸°ëŠ¥ ì°¨ë‹¨
   - ê°€ì¥ ê°•ë ¥í•œ ì œì¬

2ï¸âƒ£ trading - ìë™ë§¤ë§¤ ì°¨ë‹¨
   - ë¡œê·¸ì¸ì€ ê°€ëŠ¥
   - ê±°ë˜ ê¸°ëŠ¥ë§Œ ì°¨ë‹¨
   - ì¡°íšŒ/ì„¤ì •ì€ ê°€ëŠ¥

3ï¸âƒ£ payment - ê²°ì œ ì°¨ë‹¨
   - ìƒˆë¡œìš´ ê²°ì œ ë¶ˆê°€
   - êµ¬ë… ê°±ì‹  ì°¨ë‹¨
   - í™˜ë¶ˆ ìš”ì²­ ëŒ€ê¸°

4ï¸âƒ£ withdrawal - ì¶œê¸ˆ ì°¨ë‹¨
   - ë³´ì•ˆ ì´ìŠˆ ì‹œ
   - ìê¸ˆ ì´ë™ ì œí•œ
   - ì…ê¸ˆì€ ê°€ëŠ¥

5ï¸âƒ£ feature - íŠ¹ì • ê¸°ëŠ¥ ì°¨ë‹¨
   - ì¼ë¶€ ê¸°ëŠ¥ë§Œ ì œí•œ
   - ë‚˜ë¨¸ì§€ëŠ” ì •ìƒ ì‚¬ìš©

====================================
âš–ï¸ SEVERITY LEVELS
====================================

warning - ê²½ê³ 
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- ì²« ìœ„ë°˜ ì‹œ
- ê²½ê³  ë©”ì‹œì§€ë§Œ í‘œì‹œ
- ê¸°ëŠ¥ ì œí•œ ì—†ìŒ

temporary - ì¼ì‹œ ì •ì§€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- ê¸°ê°„ ì œí•œ (7ì¼, 30ì¼ ë“±)
- ê¸°ê°„ ë§Œë£Œ ì‹œ ìë™ í•´ì œ
- 2ì°¨ ìœ„ë°˜ ì‹œ

permanent - ì˜êµ¬ ì •ì§€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- í•´ì œ ë¶ˆê°€ (ê´€ë¦¬ìë§Œ ê°€ëŠ¥)
- ì¤‘ëŒ€í•œ ìœ„ë°˜ ì‹œ
- ë°˜ë³µ ìœ„ë°˜ì

====================================
ğŸ“ SUSPENSION REASONS
====================================

abuse - ì„œë¹„ìŠ¤ ì•…ìš©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- API ê³¼ë„í•œ í˜¸ì¶œ
- ì‹œìŠ¤í…œ ë¶€í•˜ ìœ ë°œ
- ìë™í™” ë‚¨ìš©

fraud - ë¶€ì • í–‰ìœ„
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- í—ˆìœ„ ì •ë³´ ì œê³µ
- ë¶ˆë²• ê±°ë˜
- ì¡°ì‘ ì‹œë„

violation - ì•½ê´€ ìœ„ë°˜
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- ì´ìš©ì•½ê´€ ìœ„ë°˜
- ì •ì±… ë¬´ì‹œ
- ê¸ˆì§€ëœ í–‰ìœ„

security - ë³´ì•ˆ ì´ìŠˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- ê³„ì • í•´í‚¹ ì˜ì‹¬
- ë¹„ì •ìƒ ì ‘ê·¼ íŒ¨í„´
- ë³´ì•ˆ ìœ„í˜‘

payment_issue - ê²°ì œ ë¬¸ì œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- ê²°ì œ ì‹¤íŒ¨ ë°˜ë³µ
- í™˜ë¶ˆ ìš”ì²­ ì¤‘
- ë¶„ìŸ ë°œìƒ

manual - ê´€ë¦¬ì ìˆ˜ë™ ì¡°ì¹˜
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- íŠ¹ë³„í•œ ì‚¬ìœ 
- ê³ ê° ìš”ì²­
- ê¸°íƒ€

====================================
ğŸ”§ API ENDPOINTS
====================================

Basic CRUD:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
GET    /api/admin/suspensions
       ?status=active
       &email=user@example.com
       &type=trading

POST   /api/admin/suspensions
       (Create suspension)

PUT    /api/admin/suspensions/:id
       (Update suspension info)

DELETE /api/admin/suspensions/:id
       (Delete suspension record)

Suspension Management:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
POST   /api/admin/suspensions/:id/lift
       (Lift/remove suspension)

POST   /api/admin/suspensions/check
       (Check if user is suspended)

User Specific:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
GET    /api/admin/suspensions/user/:email
       (Get all suspensions for user)

Utilities:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
POST   /api/admin/suspensions/expire
       (Auto-expire temporary suspensions)

GET    /api/admin/suspensions/stats
       (Get statistics)

====================================
ğŸ’» USAGE EXAMPLES
====================================

Example 1: ê³„ì • ì¼ì‹œ ì •ì§€ (7ì¼)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
POST /api/admin/suspensions
{
  "email": "violator@example.com",
  "suspension_type": "account",
  "severity": "temporary",
  "reason": "violation",
  "description": "ì•½ê´€ ìœ„ë°˜ - ë¶€ì ì ˆí•œ ê±°ë˜",
  "duration_days": 7,
  "suspended_by": "admin1"
}

Response:
{
  "success": true,
  "suspension": {
    "id": 1,
    "email": "violator@example.com",
    "suspension_type": "account",
    "severity": "temporary",
    "reason": "violation",
    "start_date": "2025-01-01T00:00:00Z",
    "end_date": "2025-01-08T00:00:00Z",
    "status": "active"
  }
}

Example 2: ìë™ë§¤ë§¤ ì˜êµ¬ ì°¨ë‹¨
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
POST /api/admin/suspensions
{
  "email": "abuser@example.com",
  "suspension_type": "trading",
  "severity": "permanent",
  "reason": "abuse",
  "description": "ê³¼ë„í•œ API í˜¸ì¶œë¡œ ì‹œìŠ¤í…œ ë¶€í•˜ ìœ ë°œ",
  "suspended_by": "admin2"
}

Example 3: ì •ì§€ í•´ì œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
POST /api/admin/suspensions/1/lift
{
  "lifted_by": "admin1"
}

Response:
{
  "success": true,
  "suspension": {
    "id": 1,
    "status": "lifted",
    "lifted_by": "admin1",
    "lifted_at": "2025-01-05T00:00:00Z"
  }
}

Example 4: ì‚¬ìš©ì ì •ì§€ ì—¬ë¶€ í™•ì¸
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
POST /api/admin/suspensions/check
{
  "email": "user@example.com",
  "feature": "trading"
}

Response:
{
  "success": true,
  "email": "user@example.com",
  "feature": "trading",
  "is_suspended": true,
  "can_access": false,
  "active_suspensions": [...]
}

Example 5: ì‚¬ìš©ìì˜ ëª¨ë“  ì •ì§€ ë‚´ì—­
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
GET /api/admin/suspensions/user/user@example.com

Response:
{
  "success": true,
  "email": "user@example.com",
  "all_suspensions": [...],
  "active_suspensions": [...],
  "count": {
    "total": 3,
    "active": 1
  },
  "can_access": {
    "account": true,
    "trading": false,
    "payment": true,
    "withdrawal": true
  }
}

====================================
ğŸ” CODE INTEGRATION
====================================

ë¡œê·¸ì¸ ì‹œ ì²´í¬:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
from backend.models import UserSuspension

def login(email, password):
    # ê³„ì • ì •ì§€ í™•ì¸
    if UserSuspension.is_suspended(email, 'account'):
        suspensions = UserSuspension.get_active_suspensions(email)
        suspension = suspensions[0]
        
        return {
            'success': False,
            'error': 'Account suspended',
            'reason': suspension.reason,
            'end_date': suspension.end_date
        }
    
    # ì •ìƒ ë¡œê·¸ì¸ ì²˜ë¦¬
    ...

ê±°ë˜ ì‹¤í–‰ ì „ ì²´í¬:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
def execute_trade(user_email, trade_data):
    # ê±°ë˜ ê¶Œí•œ í™•ì¸
    if not UserSuspension.can_access(user_email, 'trading'):
        return {
            'success': False,
            'error': 'Trading suspended'
        }
    
    # ê±°ë˜ ì‹¤í–‰
    ...

ê²°ì œ ì²˜ë¦¬ ì „ ì²´í¬:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
def process_payment(user_email, amount):
    # ê²°ì œ ê¶Œí•œ í™•ì¸
    if not UserSuspension.can_access(user_email, 'payment'):
        return {
            'success': False,
            'error': 'Payment suspended',
            'message': 'ê²°ì œê°€ ì œí•œë˜ì—ˆìŠµë‹ˆë‹¤. ê³ ê°ì„¼í„°ì— ë¬¸ì˜í•˜ì„¸ìš”.'
        }
    
    # ê²°ì œ ì²˜ë¦¬
    ...

ì „ì²´ ê¸°ëŠ¥ ì ‘ê·¼ í™•ì¸:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
def check_user_access(user_email):
    return {
        'account': UserSuspension.can_access(user_email, 'account'),
        'trading': UserSuspension.can_access(user_email, 'trading'),
        'payment': UserSuspension.can_access(user_email, 'payment'),
        'withdrawal': UserSuspension.can_access(user_email, 'withdrawal')
    }

====================================
âš™ï¸ AUTO EXPIRATION
====================================

ìë™ ë§Œë£Œ ì²˜ë¦¬:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Cron jobìœ¼ë¡œ ë§¤ì¼ ì‹¤í–‰
POST /api/admin/suspensions/expire

# ë˜ëŠ” Pythonìœ¼ë¡œ:
from backend.database import db
result = db.session.execute(
    db.text("SELECT expire_user_suspensions()")
)
expired_count = result.scalar()
print(f"{expired_count} suspensions expired")

====================================
ğŸ“Š STATISTICS & MONITORING
====================================

ì „ì²´ í†µê³„:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
GET /api/admin/suspensions/stats

Returns:
{
  "total": 50,
  "active": 20,
  "lifted": 25,
  "expired": 5,
  "by_type": {
    "account": 10,
    "trading": 30,
    "payment": 10
  },
  "by_reason": {
    "abuse": 15,
    "violation": 20,
    "fraud": 15
  },
  "by_severity": {
    "warning": 10,
    "temporary": 30,
    "permanent": 10
  }
}

====================================
ğŸ”’ SECURITY & BEST PRACTICES
====================================

âœ… Admin token required for all endpoints
âœ… Automatic expiration of temporary suspensions
âœ… Audit trail (suspended_by, lifted_by)
âœ… Status tracking (active, lifted, expired)
âœ… Soft delete (lift instead of delete)

Best Practices:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. Always document reason clearly
2. Use lift instead of delete
3. Start with warning before temporary
4. Reserve permanent for serious violations
5. Review suspensions regularly
6. Auto-expire temporary suspensions daily

====================================
ğŸ“¦ INSTALLATION
====================================

Files uploaded:
âœ… backend/models/user_suspension.py
âœ… backend/routes/suspension_admin.py
âœ… backend/migrations/004_add_user_suspensions.sql

Run migration:
ssh root@158.247.222.216
cd /opt/coinpulse
psql -U postgres -d coinpulse -f backend/migrations/004_add_user_suspensions.sql

Restart service:
systemctl restart coinpulse

Test:
curl -H "Authorization: Bearer coinpulse_admin_2024_secure_token" \
     http://coinpulse.sinsi.ai/api/admin/suspensions/stats

====================================
âœ… SUMMARY
====================================

Created: Complete user suspension system
Purpose: Service access control and moderation
Types: 5 suspension types (account, trading, payment, withdrawal, feature)
Severity: 3 levels (warning, temporary, permanent)
Reasons: 6 categories (abuse, fraud, violation, security, payment, manual)
API: 10 endpoints with full management
Integration: Simple can_access() checks
Security: Admin-only with audit trail

ğŸš€ System ready for deployment!

Run: upload_complete_admin.bat

====================================