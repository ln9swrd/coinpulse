        <!-- Page Header -->
        <header class="page-header">
            <div class="top-bar">
                <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M3 12h18M3 6h18M3 18h18"/>
                    </svg>
                </button>

                <h1 class="page-title" id="page-title">Í∞úÏöî</h1>

                <div class="top-bar-actions">
                    <!-- Notifications -->
                    <div class="notification-wrapper" style="position: relative;">
                        <button class="icon-btn" id="notifications-btn" aria-label="ÏïåÎ¶º">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                            </svg>
                            <span class="badge" id="notification-badge" style="display: none;">0</span>
                        </button>

                        <!-- Notification Dropdown -->
                        <div id="notification-dropdown" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 10px; width: 380px; max-height: 500px; overflow-y: auto; background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); z-index: 1000;">
                            <div style="padding: 20px; border-bottom: 1px solid #e5e7eb;">
                                <h3 style="margin: 0; font-size: 18px; font-weight: 700; color: #1f2937;">üöÄ Í∏âÎì± ÏòàÏ∏° ÏïåÎ¶º</h3>
                                <p style="margin: 5px 0 0 0; font-size: 13px; color: #6b7280;">AIÍ∞Ä Í∞êÏßÄÌïú Í∏âÎì± Í∞ÄÎä•ÏÑ±Ïù¥ ÎÜíÏùÄ ÏΩîÏù∏</p>
                            </div>
                            <div id="notification-list" style="padding: 10px;">
                                <!-- Notifications will be loaded here -->
                                <div style="padding: 40px 20px; text-align: center; color: #9ca3af;">
                                    <p>Î°úÎî© Ï§ë...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- User Menu -->
                    <div class="user-menu">
                        <button class="user-menu-btn" id="user-menu-btn">
                            <div class="user-avatar-small">
                                <span id="user-initial-small">U</span>
                            </div>
                        </button>
                        <div class="user-menu-dropdown" id="user-menu-dropdown">
                            <a href="#profile" class="dropdown-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                                <span>ÌîÑÎ°úÌïÑ</span>
                            </a>
                            <a href="#settings" class="dropdown-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <circle cx="12" cy="12" r="3"></circle>
                                    <path d="M12 1v6m0 6v6m-9-9h6m6 0h6"></path>
                                </svg>
                                <span>ÏÑ§Ï†ï</span>
                            </a>
                            <!-- Admin Menu (only visible for admins) -->
                            <a href="#admin" class="dropdown-item admin-only" id="admin-menu-item" style="display: none;" onclick="event.preventDefault(); window.location.hash = 'admin';">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                    <path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path>
                                </svg>
                                <span>Í¥ÄÎ¶¨Ïûê</span>
                            </a>
                            <div class="dropdown-divider"></div>
                            <button class="dropdown-item logout-item" id="logout-dropdown">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                    <polyline points="16 17 21 12 16 7"></polyline>
                                    <line x1="21" y1="12" x2="9" y2="12"></line>
                                </svg>
                                <span>Î°úÍ∑∏ÏïÑÏõÉ</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <script>
            // Header initialization script
            (function() {
                console.log('[Header] Initializing page header...');

                // Format price with 2 decimal places
                function formatPrice(price) {
                    if (price === null || price === undefined) return '-';
                    return Number(price).toLocaleString('ko-KR', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });
                }

                // Mobile menu toggle
                const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
                const sidebar = document.getElementById('sidebar');

                if (mobileMenuToggle && sidebar) {
                    mobileMenuToggle.addEventListener('click', () => {
                        sidebar.classList.toggle('mobile-open');
                        console.log('[Header] Mobile menu toggled');
                    });
                }

                // User menu dropdown
                const userMenuBtn = document.getElementById('user-menu-btn');
                const userMenuDropdown = document.getElementById('user-menu-dropdown');

                if (userMenuBtn && userMenuDropdown) {
                    userMenuBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        userMenuDropdown.classList.toggle('show');
                    });

                    // Close dropdown when clicking outside
                    document.addEventListener('click', (e) => {
                        if (!userMenuBtn.contains(e.target) && !userMenuDropdown.contains(e.target)) {
                            userMenuDropdown.classList.remove('show');
                        }
                    });
                }

                // Logout button
                const logoutBtn = document.getElementById('logout-dropdown');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', () => {
                        if (confirm('Î°úÍ∑∏ÏïÑÏõÉÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                            localStorage.removeItem('access_token');
                            localStorage.removeItem('auth_token');
                            window.location.href = '/login.html';
                        }
                    });
                }

                // Notifications button
                const notificationsBtn = document.getElementById('notifications-btn');
                const notificationDropdown = document.getElementById('notification-dropdown');

                if (notificationsBtn && notificationDropdown) {
                    notificationsBtn.addEventListener('click', async (e) => {
                        e.stopPropagation();

                        // Toggle dropdown
                        const isVisible = notificationDropdown.style.display === 'block';
                        notificationDropdown.style.display = isVisible ? 'none' : 'block';

                        // Load notifications if opening
                        if (!isVisible) {
                            await loadNotificationDetails();
                        }
                    });

                    // Close dropdown when clicking outside
                    document.addEventListener('click', (e) => {
                        if (!notificationsBtn.contains(e.target) && !notificationDropdown.contains(e.target)) {
                            notificationDropdown.style.display = 'none';
                        }
                    });
                }

                // Load notification details
                async function loadNotificationDetails() {
                    const notificationList = document.getElementById('notification-list');
                    if (!notificationList) return;

                    try {
                        const token = localStorage.getItem('access_token') || localStorage.getItem('auth_token');
                        if (!token) {
                            notificationList.innerHTML = '<div style="padding: 40px 20px; text-align: center; color: #9ca3af;"><p>Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§</p></div>';
                            return;
                        }

                        const response = await fetch(`${window.location.origin}/api/surge-candidates`, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });

                        if (!response.ok) {
                            throw new Error('Failed to load notifications');
                        }

                        const data = await response.json();
                        const candidates = data.candidates || [];

                        if (candidates.length === 0) {
                            notificationList.innerHTML = '<div style="padding: 40px 20px; text-align: center; color: #9ca3af;"><p>üîç ÌòÑÏû¨ Í∏âÎì± ÏòàÏ∏° ÌõÑÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§</p></div>';
                            return;
                        }

                        // Render candidates
                        notificationList.innerHTML = candidates.map(candidate => {
                            // API returns 'score' (0-100), not 'surge_score' (0-1)
                            const score = candidate.score || 0;
                            const scoreColor = score >= 70 ? '#10b981' : score >= 50 ? '#f59e0b' : '#ef4444';

                            // Calculate expected price increase based on score
                            const expectedIncrease = score >= 70 ? 10 : score >= 50 ? 5 : 3;
                            const predictedPrice = candidate.current_price * (1 + expectedIncrease / 100);

                            // Get main signal info
                            const signals = candidate.signals || {};
                            let signalInfo = '';
                            if (signals.panic_recovery) {
                                signalInfo = signals.panic_recovery.description || '';
                            } else if (signals.oversold_detection) {
                                signalInfo = signals.oversold_detection.description || '';
                            } else if (signals.volume_reversal) {
                                signalInfo = signals.volume_reversal.description || '';
                            }

                            return `
                                <div style="padding: 15px; margin-bottom: 10px; border-radius: 8px; background: #f9fafb; border-left: 4px solid ${scoreColor}; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='#f9fafb'" onclick="window.location.hash='surge'">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span style="font-weight: 700; font-size: 16px; color: #1f2937;">${candidate.market}</span>
                                            <span style="background: ${scoreColor}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 600;">Ï†êÏàò ${score}</span>
                                            ${candidate.recommendation === 'strong_buy' ? '<span style="background: #10b981; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 600;">Í∞ïÎ†• Îß§Ïàò</span>' : ''}
                                        </div>
                                        <span style="font-weight: 700; color: #10b981; font-size: 14px;">+${expectedIncrease}%</span>
                                    </div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px; color: #6b7280; margin-bottom: 8px;">
                                        <div>
                                            <span style="color: #9ca3af;">ÌòÑÏû¨Í∞Ä:</span>
                                            <span style="font-weight: 600; color: #374151; margin-left: 4px;">${formatPrice(candidate.current_price)}Ïõê</span>
                                        </div>
                                        <div>
                                            <span style="color: #9ca3af;">ÏòàÏÉÅÍ∞Ä:</span>
                                            <span style="font-weight: 600; color: #10b981; margin-left: 4px;">${formatPrice(predictedPrice)}Ïõê</span>
                                        </div>
                                    </div>
                                    ${signalInfo ? `<div style="font-size: 11px; color: #6b7280; padding: 6px 8px; background: #f3f4f6; border-radius: 4px; margin-bottom: 6px;">üìä ${signalInfo}</div>` : ''}
                                    <div style="font-size: 11px; color: #9ca3af;">
                                        ${new Date(candidate.analyzed_at).toLocaleString('ko-KR', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })} Î∂ÑÏÑù
                                    </div>
                                </div>
                            `;
                        }).join('');

                    } catch (error) {
                        console.error('[Header] Error loading notification details:', error);
                        notificationList.innerHTML = '<div style="padding: 40px 20px; text-align: center; color: #ef4444;"><p>‚ö†Ô∏è ÏïåÎ¶ºÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§</p></div>';
                    }
                }

                // Load notification count
                async function loadNotificationCount() {
                    try {
                        const token = localStorage.getItem('access_token') || localStorage.getItem('auth_token');
                        if (!token) return;

                        // TODO: Replace with actual API endpoint
                        // For now, check surge candidates as notification source
                        const response = await fetch(`${window.location.origin}/api/surge-candidates`, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (response.ok) {
                            const data = await response.json();
                            const count = data.candidates?.length || 0;

                            const badge = document.getElementById('notification-badge');
                            if (badge && count > 0) {
                                badge.textContent = count;
                                badge.style.display = 'flex';
                                console.log('[Header] Notification count:', count);
                            }
                        }
                    } catch (error) {
                        console.error('[Header] Error loading notification count:', error);
                    }
                }

                // Load notification count on init
                loadNotificationCount();

                // Refresh every 60 seconds
                setInterval(loadNotificationCount, 60000);

                // Fire header loaded event
                window.dispatchEvent(new Event('headerLoaded'));
                console.log('[Header] Page header initialized');
            })();
        </script>
