<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹œêµ¬ ì´ˆëŒ€í•˜ê¸° - CoinPulse</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header p {
            color: #666;
            font-size: 15px;
            line-height: 1.6;
        }

        .reward-highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }

        .reward-highlight h3 {
            font-size: 20px;
            margin-bottom: 8px;
        }

        .reward-highlight p {
            color: rgba(255, 255, 255, 0.95);
            font-size: 14px;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card h2 {
            color: #333;
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .referral-code-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 3px solid #667eea;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
        }

        .referral-code-label {
            color: #666;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .referral-code {
            font-size: 36px;
            font-weight: 900;
            color: #667eea;
            letter-spacing: 3px;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
        }

        .referral-link-container {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .referral-link {
            flex: 1;
            font-size: 14px;
            color: #667eea;
            word-break: break-all;
            font-family: monospace;
        }

        .copy-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .copy-btn:active {
            transform: translateY(0);
        }

        .copy-btn.copied {
            background: #10b981;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 24px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 900;
            color: #667eea;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            font-weight: 600;
        }

        .recent-referrals {
            max-height: 400px;
            overflow-y: auto;
        }

        .referral-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid #eee;
            transition: background 0.2s;
        }

        .referral-item:hover {
            background: #f8f9fa;
        }

        .referral-item:last-child {
            border-bottom: none;
        }

        .referral-info {
            flex: 1;
        }

        .referral-email {
            color: #333;
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .referral-date {
            color: #999;
            font-size: 13px;
        }

        .reward-status {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .reward-granted {
            background: #d1fae5;
            color: #065f46;
        }

        .reward-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .empty-state-text {
            font-size: 16px;
            margin-bottom: 8px;
        }

        .empty-state-subtext {
            font-size: 14px;
            color: #bbb;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .share-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .share-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .share-btn-kakao {
            background: #FEE500;
            color: #000000;
        }

        .share-btn-telegram {
            background: #0088cc;
            color: white;
        }

        .share-btn-twitter {
            background: #1DA1F2;
            color: white;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 24px;
            }

            .referral-code {
                font-size: 28px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .referral-link-container {
                flex-direction: column;
            }

            .copy-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>
                ğŸ ì¹œêµ¬ ì´ˆëŒ€í•˜ê¸°
            </h1>
            <p>ì¹œêµ¬ë¥¼ ì´ˆëŒ€í•˜ê³  ì„œë¡œ 30ì¼ ë¬´ë£Œ í”„ë¦¬ë¯¸ì—„ì„ ë°›ìœ¼ì„¸ìš”!</p>

            <div class="reward-highlight">
                <h3>ğŸ’ ì´ˆëŒ€ ë³´ìƒ</h3>
                <p>ì¹œêµ¬ê°€ ê°€ì…í•˜ë©´ <strong>ì¶”ì²œì¸ê³¼ ì¹œêµ¬ ëª¨ë‘</strong> 30ì¼ ë¬´ë£Œ í”„ë¦¬ë¯¸ì—„ í˜œíƒì´ ìë™ìœ¼ë¡œ ì§€ê¸‰ë©ë‹ˆë‹¤.</p>
            </div>
        </div>

        <!-- Referral Code Card -->
        <div class="card">
            <h2>ğŸ“‹ ë‚´ ì¶”ì²œ ì½”ë“œ</h2>

            <div class="referral-code-container">
                <div class="referral-code-label">ë‚´ ì¶”ì²œ ì½”ë“œ</div>
                <div class="referral-code" id="referral-code">ë¡œë”© ì¤‘...</div>

                <div class="referral-link-container">
                    <div class="referral-link" id="referral-link">ë¡œë”© ì¤‘...</div>
                    <button class="copy-btn" id="copy-link-btn" onclick="copyReferralLink()">
                        ğŸ“‹ ë§í¬ ë³µì‚¬
                    </button>
                </div>

                <button class="copy-btn" onclick="copyReferralCode()" style="width: 100%; margin-top: 10px;">
                    ğŸ“ ì½”ë“œë§Œ ë³µì‚¬
                </button>
            </div>

            <div class="share-buttons">
                <button class="share-btn share-btn-kakao" onclick="shareKakao()">
                    ğŸ’¬ ì¹´ì¹´ì˜¤í†¡ ê³µìœ 
                </button>
                <button class="share-btn share-btn-telegram" onclick="shareTelegram()">
                    âœˆï¸ í…”ë ˆê·¸ë¨ ê³µìœ 
                </button>
                <button class="share-btn share-btn-twitter" onclick="shareTwitter()">
                    ğŸ¦ íŠ¸ìœ„í„° ê³µìœ 
                </button>
            </div>
        </div>

        <!-- Statistics Card -->
        <div class="card">
            <h2>ğŸ“Š ì´ˆëŒ€ í†µê³„</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-referrals">0</div>
                    <div class="stat-label">ì´ ì´ˆëŒ€ ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="rewarded-referrals">0</div>
                    <div class="stat-label">ë³´ìƒ ì§€ê¸‰ ì™„ë£Œ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="pending-referrals">0</div>
                    <div class="stat-label">ëŒ€ê¸° ì¤‘</div>
                </div>
            </div>
        </div>

        <!-- Recent Referrals Card -->
        <div class="card">
            <h2>ğŸ“œ ìµœê·¼ ì´ˆëŒ€ ë‚´ì—­</h2>

            <div id="recent-referrals-container" class="recent-referrals">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>ì´ˆëŒ€ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let referralCode = '';
        let referralLink = '';

        // Load referral data on page load
        document.addEventListener('DOMContentLoaded', async () => {
            await loadReferralCode();
            await loadReferralStats();
        });

        /**
         * Load user's referral code
         */
        async function loadReferralCode() {
            try {
                const response = await fetch(`${window.location.origin}/api/referral/code`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.success) {
                    referralCode = data.code;
                    referralLink = data.link;

                    document.getElementById('referral-code').textContent = referralCode;
                    document.getElementById('referral-link').textContent = referralLink;

                    console.log('[Referral] Code loaded:', referralCode);
                } else {
                    throw new Error(data.error || 'Failed to load referral code');
                }
            } catch (error) {
                console.error('[Referral] Failed to load code:', error);
                document.getElementById('referral-code').textContent = 'ë¡œë“œ ì‹¤íŒ¨';
                document.getElementById('referral-link').textContent = 'í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”';
            }
        }

        /**
         * Load referral statistics
         */
        async function loadReferralStats() {
            try {
                const response = await fetch(`${window.location.origin}/api/referral/stats`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.success) {
                    const stats = data.stats;

                    // Update statistics
                    document.getElementById('total-referrals').textContent = stats.total_referrals;
                    document.getElementById('rewarded-referrals').textContent = stats.rewarded_referrals;
                    document.getElementById('pending-referrals').textContent = stats.pending_referrals;

                    // Display recent referrals
                    displayRecentReferrals(stats.recent_referrals);

                    console.log('[Referral] Stats loaded:', stats);
                } else {
                    throw new Error(data.error || 'Failed to load stats');
                }
            } catch (error) {
                console.error('[Referral] Failed to load stats:', error);
                document.getElementById('recent-referrals-container').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">âš ï¸</div>
                        <div class="empty-state-text">í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>
                        <div class="empty-state-subtext">í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”</div>
                    </div>
                `;
            }
        }

        /**
         * Display recent referrals list
         */
        function displayRecentReferrals(referrals) {
            const container = document.getElementById('recent-referrals-container');

            if (!referrals || referrals.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ‘¥</div>
                        <div class="empty-state-text">ì•„ì§ ì´ˆëŒ€í•œ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                        <div class="empty-state-subtext">ì¹œêµ¬ì—ê²Œ ì¶”ì²œ ë§í¬ë¥¼ ê³µìœ í•˜ì„¸ìš”!</div>
                    </div>
                `;
                return;
            }

            const html = referrals.map(referral => {
                const date = new Date(referral.created_at);
                const formattedDate = date.toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                return `
                    <div class="referral-item">
                        <div class="referral-info">
                            <div class="referral-email">${referral.email}</div>
                            <div class="referral-date">${formattedDate}</div>
                        </div>
                        <div class="reward-status ${referral.reward_granted ? 'reward-granted' : 'reward-pending'}">
                            ${referral.reward_granted ? 'âœ“ ë³´ìƒ ì§€ê¸‰ë¨' : 'â³ ëŒ€ê¸° ì¤‘'}
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        /**
         * Copy referral link to clipboard
         */
        async function copyReferralLink() {
            try {
                await navigator.clipboard.writeText(referralLink);

                const btn = document.getElementById('copy-link-btn');
                const originalText = btn.textContent;
                btn.textContent = 'âœ“ ë³µì‚¬ë¨!';
                btn.classList.add('copied');

                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.classList.remove('copied');
                }, 2000);

                console.log('[Referral] Link copied to clipboard');
            } catch (error) {
                console.error('[Referral] Failed to copy link:', error);
                alert('ë§í¬ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
            }
        }

        /**
         * Copy referral code to clipboard
         */
        async function copyReferralCode() {
            try {
                await navigator.clipboard.writeText(referralCode);

                alert('âœ“ ì¶”ì²œ ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\n' + referralCode);
                console.log('[Referral] Code copied to clipboard');
            } catch (error) {
                console.error('[Referral] Failed to copy code:', error);
                alert('ì½”ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
            }
        }

        /**
         * Share via KakaoTalk
         */
        function shareKakao() {
            const message = `ğŸ ì½”ì¸í„ìŠ¤ ì´ˆëŒ€ì¥!\n\nìë™ íŠ¸ë ˆì´ë”© í”Œë«í¼ ì½”ì¸í„ìŠ¤ì— ê°€ì…í•˜ê³  30ì¼ ë¬´ë£Œ í”„ë¦¬ë¯¸ì—„ì„ ë°›ìœ¼ì„¸ìš”!\n\n${referralLink}`;

            // Check if Kakao SDK is available
            if (typeof Kakao !== 'undefined' && Kakao.isInitialized()) {
                Kakao.Link.sendDefault({
                    objectType: 'text',
                    text: message,
                    link: {
                        webUrl: referralLink,
                        mobileWebUrl: referralLink
                    }
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(message);
                alert('ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\në©”ì‹œì§€ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        /**
         * Share via Telegram
         */
        function shareTelegram() {
            const message = encodeURIComponent(`ğŸ ì½”ì¸í„ìŠ¤ ì´ˆëŒ€ì¥!\n\nìë™ íŠ¸ë ˆì´ë”© í”Œë«í¼ ì½”ì¸í„ìŠ¤ì— ê°€ì…í•˜ê³  30ì¼ ë¬´ë£Œ í”„ë¦¬ë¯¸ì—„ì„ ë°›ìœ¼ì„¸ìš”!\n\n${referralLink}`);
            window.open(`https://t.me/share/url?url=${encodeURIComponent(referralLink)}&text=${message}`, '_blank');
        }

        /**
         * Share via Twitter
         */
        function shareTwitter() {
            const text = encodeURIComponent(`ğŸ ì½”ì¸í„ìŠ¤ ì´ˆëŒ€ì¥! ìë™ íŠ¸ë ˆì´ë”© í”Œë«í¼ì— ê°€ì…í•˜ê³  30ì¼ ë¬´ë£Œ í”„ë¦¬ë¯¸ì—„ì„ ë°›ìœ¼ì„¸ìš”!`);
            const url = encodeURIComponent(referralLink);
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
        }
    </script>
</body>
</html>
