<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸‰ë“±ì˜ˆì¸¡ ì´ë ¥ - ì½”ì¸í„ìŠ¤ ê´€ë¦¬ì</title>
    <link rel="stylesheet" href="css/internal-pages.css">
    <style>
        /* Surge History specific styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
        }

        .back-link {
            color: white;
            text-decoration: none;
            font-size: 14px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            transition: background 0.3s;
        }

        .back-link:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Content */
        .content {
            padding: 40px;
        }

        /* Stats Cards - Clean & Visible */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            color: #2d3748;
            padding: 32px 28px;
            border-radius: 20px;
            border-left: 6px solid #667eea;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            position: relative;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

        /* Different border colors for different stat types */
        .stat-card:nth-child(1) {
            border-left-color: #667eea;
        }

        .stat-card:nth-child(2) {
            border-left-color: #f56565;
        }

        .stat-card:nth-child(3) {
            border-left-color: #4299e1;
        }

        .stat-card:nth-child(4) {
            border-left-color: #48bb78;
        }

        .stat-card:nth-child(5) {
            border-left-color: #ed8936;
        }

        .stat-card:nth-child(6) {
            border-left-color: #9f7aea;
        }

        .stat-label {
            font-size: 15px;
            color: #718096;
            margin-bottom: 12px;
            font-weight: 600;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
        }

        .stat-icon {
            font-size: 24px;
        }

        .stat-value {
            font-size: 48px;
            font-weight: 800;
            line-height: 1.2;
            color: #1a202c;
        }

        .stat-card:nth-child(4) .stat-value {
            color: #48bb78;
        }

        .stat-unit {
            font-size: 22px;
            color: #718096;
            margin-left: 6px;
            font-weight: 600;
        }

        /* Filters */
        .filters {
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }

        .filters h3 {
            margin-bottom: 16px;
            color: #333;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-size: 14px;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
        }

        .filter-group select,
        .filter-group input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }

        .filter-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        /* Table */
        .table-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #e9ecef;
        }

        .table-header h3 {
            color: #333;
            font-size: 18px;
        }

        .table-actions {
            display: flex;
            gap: 12px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f8f9fa;
        }

        th {
            padding: 16px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
        }

        td {
            padding: 16px;
            border-top: 1px solid #e9ecef;
            font-size: 14px;
            color: #333;
        }

        tr:hover {
            background: #f8f9fa;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            padding: 24px;
        }

        .page-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .page-btn:hover:not(:disabled) {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .page-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 60px;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #f3f4f6;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Error State */
        .error-state {
            text-align: center;
            padding: 60px 20px;
        }

        .error-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .error-state h3 {
            margin-bottom: 8px;
            color: #333;
        }

        .error-state p {
            color: #666;
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filter-grid {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 12px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š ê¸‰ë“±ì˜ˆì¸¡ ì´ë ¥ ê´€ë¦¬</h1>
            <a href="dashboard.html#admin" class="back-link">â† ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</a>
        </header>

        <div class="content">
            <!-- Statistics Cards - Enhanced Visibility -->
            <div class="stats-grid" id="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">
                        <span class="stat-icon">ğŸ“Š</span>
                        ì „ì²´ ì˜ˆì¸¡
                    </div>
                    <div class="stat-value" id="stat-total">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">
                        <span class="stat-icon">ğŸ¤–</span>
                        ìë™ê±°ë˜
                    </div>
                    <div class="stat-value" id="stat-auto-traded">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">
                        <span class="stat-icon">ğŸ¯</span>
                        í‰ê·  ì‹ ë¢°ë„
                    </div>
                    <div class="stat-value" id="stat-confidence">-<span class="stat-unit">%</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">
                        <span class="stat-icon">ğŸ’°</span>
                        ì´ ì†ìµ
                    </div>
                    <div class="stat-value" id="stat-profit">-<span class="stat-unit">ì›</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">
                        <span class="stat-icon">âœ…</span>
                        ìˆ˜ìµ ê±°ë˜
                    </div>
                    <div class="stat-value" id="stat-profitable">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">
                        <span class="stat-icon">âŒ</span>
                        ì†ì‹¤ ê±°ë˜
                    </div>
                    <div class="stat-value" id="stat-losing">-</div>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters">
                <h3>ğŸ” í•„í„°</h3>
                <div class="filter-grid">
                    <div class="filter-group">
                        <label>ë§ˆì¼“</label>
                        <select id="filter-market">
                            <option value="">ì „ì²´</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>ì‹ í˜¸ ìœ í˜•</label>
                        <select id="filter-signal-type">
                            <option value="">ì „ì²´</option>
                            <option value="surge">Surge</option>
                            <option value="breakout">Breakout</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>ìë™ê±°ë˜</label>
                        <select id="filter-auto-traded">
                            <option value="">ì „ì²´</option>
                            <option value="true">ìë™ê±°ë˜</option>
                            <option value="false">ìˆ˜ë™</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>ìƒíƒœ</label>
                        <select id="filter-status">
                            <option value="">ì „ì²´</option>
                            <option value="pending">Pending (ì§„í–‰ì¤‘)</option>
                            <option value="win">Win (ìˆ˜ìµ)</option>
                            <option value="lose">Lose (ì†ì‹¤)</option>
                            <option value="backtest">Backtest (ë°±í…ŒìŠ¤íŠ¸)</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>ì‹œì‘ì¼</label>
                        <input type="date" id="filter-start-date">
                    </div>
                    <div class="filter-group">
                        <label>ì¢…ë£Œì¼</label>
                        <input type="date" id="filter-end-date">
                    </div>
                </div>
                <div class="filter-actions">
                    <button class="btn btn-primary" onclick="applyFilters()">í•„í„° ì ìš©</button>
                    <button class="btn btn-secondary" onclick="resetFilters()">ì´ˆê¸°í™”</button>
                    <button class="btn btn-secondary" onclick="exportCSV()">CSV ë‚´ë³´ë‚´ê¸°</button>
                </div>
            </div>

            <!-- Table -->
            <div class="table-container">
                <div class="table-header">
                    <h3>ê¸‰ë“±ì˜ˆì¸¡ ë‚´ì—­</h3>
                    <div class="table-actions">
                        <select id="per-page" onchange="changePerPage()">
                            <option value="50">50ê°œì”©</option>
                            <option value="100">100ê°œì”©</option>
                            <option value="200">200ê°œì”©</option>
                            <option value="500">500ê°œì”©</option>
                        </select>
                    </div>
                </div>

                <div id="table-content">
                    <!-- Table will be loaded here -->
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>

                <div class="pagination" id="pagination">
                    <!-- Pagination will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Note: api_client.js is already loaded by dashboard.html, no need to load again -->
    <script>
    (function() {
        'use strict';

        // Coin information mapping (All 230 Upbit KRW markets)
        const COIN_INFO = {
            'WAXP': { name: 'ì™ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/waxp' },
            'CARV': { name: 'ì¹´ë¸Œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/carv' },
            'LSK': { name: 'ë¦¬ìŠ¤í¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/lsk' },
            '0G': { name: 'ì œë¡œì§€', logo: 'https://cryptoicon-api.pages.dev/api/icon/0g' },
            'BORA': { name: 'ë³´ë¼', logo: 'https://cryptoicon-api.pages.dev/api/icon/bora' },
            'PUNDIX': { name: 'í€ë””ì—‘ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/pundix' },
            'USD1': { name: 'ì›”ë“œë¦¬ë²„í‹°íŒŒì´ë‚¸ì…œìœ ì—ìŠ¤ë””', logo: 'https://cryptoicon-api.pages.dev/api/icon/usd1' },
            'BAT': { name: 'ë² ì´ì§ì–´í…ì…˜í† í°', logo: 'https://cryptoicon-api.pages.dev/api/icon/bat' },
            'HUNT': { name: 'í—ŒíŠ¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/hunt' },
            'PENGU': { name: 'íì§€í­ê·„', logo: 'https://cryptoicon-api.pages.dev/api/icon/pengu' },
            'FIL': { name: 'íŒŒì¼ì½”ì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/fil' },
            'BEAM': { name: 'ë¹”', logo: 'https://cryptoicon-api.pages.dev/api/icon/beam' },
            'DOOD': { name: 'ë‘ë“¤ì¦ˆ', logo: 'https://cryptoicon-api.pages.dev/api/icon/dood' },
            'WAVES': { name: 'ì›¨ì´ë¸Œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/waves' },
            'USDC': { name: 'ìœ ì—ìŠ¤ë””ì½”ì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/usdc' },
            'MOVE': { name: 'ë¬´ë¸Œë¨¼íŠ¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/move' },
            'TREE': { name: 'íŠ¸ë¦¬í•˜ìš°ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/tree' },
            'AERGO': { name: 'ì•„ë¥´ê³ ', logo: 'https://cryptoicon-api.pages.dev/api/icon/aergo' },
            'WET': { name: 'íœ´ë¯¸ë””íŒŒì´', logo: 'https://cryptoicon-api.pages.dev/api/icon/wet' },
            'USDT': { name: 'í…Œë”', logo: 'https://cryptoicon-api.pages.dev/api/icon/usdt' },
            '2Z': { name: 'ë”ë¸”ì œë¡œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/2z' },
            'BOUNTY': { name: 'ì²´ì¸ë°”ìš´í‹°', logo: 'https://cryptoicon-api.pages.dev/api/icon/bounty' },
            'KAITO': { name: 'ì¹´ì´í† ', logo: 'https://cryptoicon-api.pages.dev/api/icon/kaito' },
            'LPT': { name: 'ë¼ì´ë¸Œí”¼ì–´', logo: 'https://cryptoicon-api.pages.dev/api/icon/lpt' },
            'BLAST': { name: 'ë¸”ë¼ìŠ¤íŠ¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/blast' },
            'DKA': { name: 'ë””ì¹´ë¥´ê³ ', logo: 'https://cryptoicon-api.pages.dev/api/icon/dka' },
            'ANKR': { name: 'ì•µì»¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/ankr' },
            'ALGO': { name: 'ì•Œê³ ëœë“œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/algo' },
            'SHIB': { name: 'ì‹œë°”ì´ëˆ„', logo: 'https://cryptoicon-api.pages.dev/api/icon/shib' },
            'UNI': { name: 'ìœ ë‹ˆìŠ¤ì™‘', logo: 'https://cryptoicon-api.pages.dev/api/icon/uni' },
            'BIO': { name: 'ë°”ì´ì˜¤í”„ë¡œí† ì½œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/bio' },
            'WLFI': { name: 'ì›”ë“œë¦¬ë²„í‹°íŒŒì´ë‚¸ì…œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/wlfi' },
            'TOKAMAK': { name: 'í† ì¹´ë§‰ë„¤íŠ¸ì›Œí¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/tokamak' },
            'CYBER': { name: 'ì‚¬ì´ë²„', logo: 'https://cryptoicon-api.pages.dev/api/icon/cyber' },
            'DOGE': { name: 'ë„ì§€ì½”ì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/doge' },
            'WLD': { name: 'ì›”ë“œì½”ì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/wld' },
            'PEPE': { name: 'í˜í˜', logo: 'https://cryptoicon-api.pages.dev/api/icon/pepe' },
            'HBAR': { name: 'í—¤ë°ë¼', logo: 'https://cryptoicon-api.pages.dev/api/icon/hbar' },
            'BCH': { name: 'ë¹„íŠ¸ì½”ì¸ìºì‹œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/bch' },
            'NEWT': { name: 'ë‰´í„´í”„ë¡œí† ì½œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/newt' },
            'SEI': { name: 'ì„¸ì´', logo: 'https://cryptoicon-api.pages.dev/api/icon/sei' },
            'BONK': { name: 'ë´‰í¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/bonk' },
            'JST': { name: 'ì €ìŠ¤íŠ¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/jst' },
            'AAVE': { name: 'ì—ì´ë¸Œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/aave' },
            'JTO': { name: 'ì§€í† ', logo: 'https://cryptoicon-api.pages.dev/api/icon/jto' },
            'JUP': { name: 'ì£¼í”¼í„°', logo: 'https://cryptoicon-api.pages.dev/api/icon/jup' },
            'FLOW': { name: 'í”Œë¡œìš°', logo: 'https://cryptoicon-api.pages.dev/api/icon/flow' },
            'ALT': { name: 'ì•ŒíŠ¸ë ˆì´ì–´', logo: 'https://cryptoicon-api.pages.dev/api/icon/alt' },
            'LAYER': { name: 'ì†”ë ˆì´ì–´', logo: 'https://cryptoicon-api.pages.dev/api/icon/layer' },
            'TRX': { name: 'íŠ¸ë¡ ', logo: 'https://cryptoicon-api.pages.dev/api/icon/trx' },
            'POWR': { name: 'íŒŒì›Œë ›ì €', logo: 'https://cryptoicon-api.pages.dev/api/icon/powr' },
            'ATOM': { name: 'ì½”ìŠ¤ëª¨ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/atom' },
            'ARKM': { name: 'ì•„ìº„', logo: 'https://cryptoicon-api.pages.dev/api/icon/arkm' },
            'CRO': { name: 'í¬ë¡œë…¸ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/cro' },
            'NXPC': { name: 'ë„¥ìŠ¤í˜ì´ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/nxpc' },
            'A': { name: 'ë³¼íƒ€', logo: 'https://cryptoicon-api.pages.dev/api/icon/a' },
            'TRUMP': { name: 'ì˜¤í”¼ì…œíŠ¸ëŸ¼í”„', logo: 'https://cryptoicon-api.pages.dev/api/icon/trump' },
            'F': { name: 'ì‹ í“¨ì²˜ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/f' },
            'G': { name: 'ê·¸ë˜ë¹„í‹°', logo: 'https://cryptoicon-api.pages.dev/api/icon/g' },
            'CELO': { name: 'ì…€ë¡œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/celo' },
            'AERO': { name: 'ì—ì–´ë¡œë“œë¡¬íŒŒì´ë‚¸ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/aero' },
            'CTC': { name: 'í¬ë ˆë”§ì½”ì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/ctc' },
            'ANIME': { name: 'ì• ë‹ˆë©”ì½”ì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/anime' },
            'APT': { name: 'ì•±í† ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/apt' },
            'MOCA': { name: 'ëª¨ì¹´ë„¤íŠ¸ì›Œí¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/moca' },
            'API3': { name: 'ì—ì´í”¼ì•„ì´ì“°ë¦¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/api3' },
            'AHT': { name: 'ì•„í•˜í† í°', logo: 'https://cryptoicon-api.pages.dev/api/icon/aht' },
            'EGLD': { name: 'ë©€í‹°ë²„ìŠ¤ì—‘ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/egld' },
            'ERA': { name: 'ì¹¼ë°ë¼', logo: 'https://cryptoicon-api.pages.dev/api/icon/era' },
            'FF': { name: 'íŒ”ì½˜íŒŒì´ë‚¸ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/ff' },
            'PLUME': { name: 'í”Œë£¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/plume' },
            'NEO': { name: 'ë„¤ì˜¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/neo' },
            'ETC': { name: 'ì´ë”ë¦¬ì›€í´ë˜ì‹', logo: 'https://cryptoicon-api.pages.dev/api/icon/etc' },
            'IOTA': { name: 'ì•„ì´ì˜¤íƒ€', logo: 'https://cryptoicon-api.pages.dev/api/icon/iota' },
            'IOST': { name: 'ì•„ì´ì˜¤ì—ìŠ¤í‹°', logo: 'https://cryptoicon-api.pages.dev/api/icon/iost' },
            'AKT': { name: 'ì•„ì¹´ì‹œë„¤íŠ¸ì›Œí¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/akt' },
            'COW': { name: 'ì¹´ìš°í”„ë¡œí† ì½œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/cow' },
            'VIRTUAL': { name: 'ë²„ì¶”ì–¼í”„ë¡œí† ì½œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/virtual' },
            'ETH': { name: 'ì´ë”ë¦¬ì›€', logo: 'https://cryptoicon-api.pages.dev/api/icon/eth' },
            'IQ': { name: 'ì•„ì´í', logo: 'https://cryptoicon-api.pages.dev/api/icon/iq' },
            'IP': { name: 'ìŠ¤í† ë¦¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/ip' },
            'NEAR': { name: 'ë‹ˆì–´í”„ë¡œí† ì½œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/near' },
            'RVN': { name: 'ë ˆì´ë¸ì½”ì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/rvn' },
            'AGLD': { name: 'ì–´ë“œë²¤ì²˜ê³¨ë“œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/agld' },
            'ID': { name: 'ìŠ¤í˜ì´ìŠ¤ì•„ì´ë””', logo: 'https://cryptoicon-api.pages.dev/api/icon/id' },
            'IN': { name: 'ì¸í”¼ë‹›', logo: 'https://cryptoicon-api.pages.dev/api/icon/in' },
            'NOM': { name: 'ë…¸ë¯¸ë‚˜', logo: 'https://cryptoicon-api.pages.dev/api/icon/nom' },
            'WAL': { name: 'ì›”ëŸ¬ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/wal' },
            'PENDLE': { name: 'íœë“¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/pendle' },
            'BLUR': { name: 'ë¸”ëŸ¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/blur' },
            'AWE': { name: 'ì—ì´ë”ë¸”ìœ ì´', logo: 'https://cryptoicon-api.pages.dev/api/icon/awe' },
            'THETA': { name: 'ì„íƒ€í† í°', logo: 'https://cryptoicon-api.pages.dev/api/icon/theta' },
            'AXL': { name: 'ì—‘ì…€ë¼', logo: 'https://cryptoicon-api.pages.dev/api/icon/axl' },
            'HP': { name: 'íˆí¬í”„ë¡œí† ì½œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/hp' },
            'SAND': { name: 'ìƒŒë“œë°•ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/sand' },
            'WCT': { name: 'ì›”ë ›ì»¤ë„¥íŠ¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/wct' },
            'YGG': { name: 'ì¼ë“œê¸¸ë“œê²Œì„ì¦ˆ', logo: 'https://cryptoicon-api.pages.dev/api/icon/ygg' },
            'AXS': { name: 'ì—‘ì‹œì¸í”¼ë‹ˆí‹°', logo: 'https://cryptoicon-api.pages.dev/api/icon/axs' },
            'ARDR': { name: 'ì•„ë”', logo: 'https://cryptoicon-api.pages.dev/api/icon/ardr' },
            'AQT': { name: 'ì•ŒíŒŒì¿¼í¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/aqt' },
            'ME': { name: 'ë§¤ì§ì—ë´', logo: 'https://cryptoicon-api.pages.dev/api/icon/me' },
            'TRUST': { name: 'ì¸íŠœì´ì…˜', logo: 'https://cryptoicon-api.pages.dev/api/icon/trust' },
            'SONIC': { name: 'ì†Œë‹‰SVM', logo: 'https://cryptoicon-api.pages.dev/api/icon/sonic' },
            'ARB': { name: 'ì•„ë¹„íŠ¸ëŸ¼', logo: 'https://cryptoicon-api.pages.dev/api/icon/arb' },
            'POL': { name: 'í´ë¦¬ê³¤ì—ì½”ì‹œìŠ¤í…œí† í°', logo: 'https://cryptoicon-api.pages.dev/api/icon/pol' },
            'CVC': { name: 'ì‹œë¹…', logo: 'https://cryptoicon-api.pages.dev/api/icon/cvc' },
            'T': { name: 'ì“°ë ˆìŠ¤í™€ë“œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/t' },
            'W': { name: 'ì›œí™€', logo: 'https://cryptoicon-api.pages.dev/api/icon/w' },
            'ARK': { name: 'ì•„í¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/ark' },
            'AVNT': { name: 'ì•„ë°˜í‹°ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/avnt' },
            'LA': { name: 'ë¼ê·¸ë‘ì£¼', logo: 'https://cryptoicon-api.pages.dev/api/icon/la' },
            'HYPER': { name: 'í•˜ì´í¼ë ˆì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/hyper' },
            'ATH': { name: 'ì—ì´ì…”', logo: 'https://cryptoicon-api.pages.dev/api/icon/ath' },
            'TAIKO': { name: 'íƒ€ì´ì½”', logo: 'https://cryptoicon-api.pages.dev/api/icon/taiko' },
            'AVAX': { name: 'ì•„ë°œë€ì²´', logo: 'https://cryptoicon-api.pages.dev/api/icon/avax' },
            'CPOOL': { name: 'í´ë¦¬ì–´í’€', logo: 'https://cryptoicon-api.pages.dev/api/icon/cpool' },
            'IMX': { name: 'ì´ë®¤í„°ë¸”ì—‘ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/imx' },
            'SC': { name: 'ì‹œì•„ì½”ì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/sc' },
            'INJ': { name: 'ì¸ì í‹°ë¸Œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/inj' },
            'MVL': { name: 'ì— ë¸”', logo: 'https://cryptoicon-api.pages.dev/api/icon/mvl' },
            'HIVE': { name: 'í•˜ì´ë¸Œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/hive' },
            'CBK': { name: 'ì½”ë°•í† í°', logo: 'https://cryptoicon-api.pages.dev/api/icon/cbk' },
            'OM': { name: 'ë§ŒíŠ¸ë¼', logo: 'https://cryptoicon-api.pages.dev/api/icon/om' },
            'XLM': { name: 'ìŠ¤í…”ë¼ë£¨ë©˜', logo: 'https://cryptoicon-api.pages.dev/api/icon/xlm' },
            'OP': { name: 'ì˜µí‹°ë¯¸ì¦˜', logo: 'https://cryptoicon-api.pages.dev/api/icon/op' },
            'SAFE': { name: 'ì„¸ì´í”„', logo: 'https://cryptoicon-api.pages.dev/api/icon/safe' },
            'GLM': { name: 'ê³¨ë ˜', logo: 'https://cryptoicon-api.pages.dev/api/icon/glm' },
            'SUPER': { name: 'ìŠˆí¼ë²„ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/super' },
            'LINEA': { name: 'ë¦¬ë„¤ì•„', logo: 'https://cryptoicon-api.pages.dev/api/icon/linea' },
            'KERNEL': { name: 'ì»¤ë„ë‹¤ì˜¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/kernel' },
            'POKT': { name: 'í¬ì¼“ë„¤íŠ¸ì›Œí¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/pokt' },
            'ZKC': { name: 'ë°”ìš´ë“œë¦¬ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/zkc' },
            'KNC': { name: 'ì¹´ì´ë²„ë„¤íŠ¸ì›Œí¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/knc' },
            'AUCTION': { name: 'ë°”ìš´ìŠ¤í† í°', logo: 'https://cryptoicon-api.pages.dev/api/icon/auction' },
            'ORDER': { name: 'ì˜¤ëœë¦¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/order' },
            'DRIFT': { name: 'ë“œë¦¬í”„íŠ¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/drift' },
            'FCT2': { name: 'í”¼ë¥´ë§ˆì²´ì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/fct2' },
            'MTL': { name: 'ë©”íƒˆ', logo: 'https://cryptoicon-api.pages.dev/api/icon/mtl' },
            'VET': { name: 'ë¹„ì²´ì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/vet' },
            'QTUM': { name: 'í€€í…€', logo: 'https://cryptoicon-api.pages.dev/api/icon/qtum' },
            'TT': { name: 'ì¬ë”ì½”ì–´', logo: 'https://cryptoicon-api.pages.dev/api/icon/tt' },
            'LINK': { name: 'ì²´ì¸ë§í¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/link' },
            'XRP': { name: 'ì—‘ìŠ¤ì•Œí”¼(ë¦¬í”Œ)', logo: 'https://cryptoicon-api.pages.dev/api/icon/xrp' },
            'CHZ': { name: 'ì¹ ë¦¬ì¦ˆ', logo: 'https://cryptoicon-api.pages.dev/api/icon/chz' },
            'ASTR': { name: 'ì•„ìŠ¤íƒ€', logo: 'https://cryptoicon-api.pages.dev/api/icon/astr' },
            'STORJ': { name: 'ìŠ¤í† ë¦¬ì§€', logo: 'https://cryptoicon-api.pages.dev/api/icon/storj' },
            'ENA': { name: 'ì—í…Œë‚˜', logo: 'https://cryptoicon-api.pages.dev/api/icon/ena' },
            'MANA': { name: 'ë””ì„¼íŠ¸ëŸ´ëœë“œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/mana' },
            'OPEN': { name: 'ì˜¤í”ˆë ›ì €', logo: 'https://cryptoicon-api.pages.dev/api/icon/open' },
            'GRS': { name: 'ê·¸ë¡œìŠ¤í†¨ì½”ì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/grs' },
            'PYTH': { name: 'í”¼ìŠ¤ë„¤íŠ¸ì›Œí¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/pyth' },
            'ENS': { name: 'ì´ë”ë¦¬ì›€ë„¤ì„ì„œë¹„ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/ens' },
            'GRT': { name: 'ë”ê·¸ë˜í”„', logo: 'https://cryptoicon-api.pages.dev/api/icon/grt' },
            'PUMP': { name: 'íŒí”„í€', logo: 'https://cryptoicon-api.pages.dev/api/icon/pump' },
            'XTZ': { name: 'í…Œì¡°ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/xtz' },
            'CKB': { name: 'ë„ˆë³´ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/ckb' },
            'KAVA': { name: 'ì¹´ë°”', logo: 'https://cryptoicon-api.pages.dev/api/icon/kava' },
            'TOSHI': { name: 'í† ì‹œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/toshi' },
            'BARD': { name: 'ë¡¬ë°”ë“œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/bard' },
            'ZRO': { name: 'ë ˆì´ì–´ì œë¡œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/zro' },
            'RAY': { name: 'ë ˆì´ë””ì›€', logo: 'https://cryptoicon-api.pages.dev/api/icon/ray' },
            'ONDO': { name: 'ì˜¨ë„íŒŒì´ë‚¸ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/ondo' },
            'ZRX': { name: 'ì œë¡œì—‘ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/zrx' },
            'GMT': { name: 'ìŠ¤í…Œí”ˆ', logo: 'https://cryptoicon-api.pages.dev/api/icon/gmt' },
            'TFUEL': { name: 'ì„íƒ€í“¨ì—˜', logo: 'https://cryptoicon-api.pages.dev/api/icon/tfuel' },
            'XPL': { name: 'í”Œë¼ì¦ˆë§ˆ', logo: 'https://cryptoicon-api.pages.dev/api/icon/xpl' },
            'MASK': { name: 'ë§ˆìŠ¤í¬ë„¤íŠ¸ì›Œí¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/mask' },
            'COMP': { name: 'ì»´íŒŒìš´ë“œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/comp' },
            'ZETA': { name: 'ì œíƒ€ì²´ì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/zeta' },
            'RED': { name: 'ë ˆë“œìŠ¤í†¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/red' },
            'TIA': { name: 'ì…€ë ˆìŠ¤í‹°ì•„', logo: 'https://cryptoicon-api.pages.dev/api/icon/tia' },
            'ADA': { name: 'ì—ì´ë‹¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/ada' },
            'ELF': { name: 'ì—˜í”„', logo: 'https://cryptoicon-api.pages.dev/api/icon/elf' },
            'STEEM': { name: 'ìŠ¤íŒ€', logo: 'https://cryptoicon-api.pages.dev/api/icon/steem' },
            'SOPH': { name: 'ì†Œí°', logo: 'https://cryptoicon-api.pages.dev/api/icon/soph' },
            'MED': { name: 'ë©”ë””ë¸”ë¡', logo: 'https://cryptoicon-api.pages.dev/api/icon/med' },
            '1INCH': { name: '1ì¸ì¹˜ë„¤íŠ¸ì›Œí¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/1inch' },
            'MEW': { name: 'ìº£ì¸ì–´ë…ìŠ¤ì›”ë“œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/mew' },
            'ORBS': { name: 'ì˜¤ë¸ŒìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/orbs' },
            'RENDER': { name: 'ë Œë”í† í°', logo: 'https://cryptoicon-api.pages.dev/api/icon/render' },
            'STG': { name: 'ìŠ¤íƒ€ê²Œì´íŠ¸íŒŒì´ë‚¸ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/stg' },
            'ORCA': { name: 'ì˜¤ë¥´ì¹´', logo: 'https://cryptoicon-api.pages.dev/api/icon/orca' },
            'BERA': { name: 'ë² ë¼ì²´ì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/bera' },
            'SIGN': { name: 'ì‚¬ì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/sign' },
            'VANA': { name: 'ë°”ë‚˜', logo: 'https://cryptoicon-api.pages.dev/api/icon/vana' },
            'DOT': { name: 'í´ì¹´ë‹·', logo: 'https://cryptoicon-api.pages.dev/api/icon/dot' },
            'MET2': { name: 'ë©”í…Œì˜¤ë¼', logo: 'https://cryptoicon-api.pages.dev/api/icon/met2' },
            'MBL': { name: 'ë¬´ë¹„ë¸”ë¡', logo: 'https://cryptoicon-api.pages.dev/api/icon/mbl' },
            'FLUID': { name: 'í”Œë£¨ì´ë“œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/fluid' },
            'BIGTIME': { name: 'ë¹…íƒ€ì„', logo: 'https://cryptoicon-api.pages.dev/api/icon/bigtime' },
            'SNT': { name: 'ìŠ¤í…Œì´í„°ìŠ¤ë„¤íŠ¸ì›Œí¬í† í°', logo: 'https://cryptoicon-api.pages.dev/api/icon/snt' },
            'SOL': { name: 'ì†”ë¼ë‚˜', logo: 'https://cryptoicon-api.pages.dev/api/icon/sol' },
            'QKC': { name: 'ì¿¼í¬ì²´ì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/qkc' },
            'META': { name: 'ë©”íƒ€ë””ì›€', logo: 'https://cryptoicon-api.pages.dev/api/icon/meta' },
            'SAHARA': { name: 'ì‚¬í•˜ë¼ì—ì´ì•„ì´', logo: 'https://cryptoicon-api.pages.dev/api/icon/sahara' },
            'MLK': { name: 'ë°€í¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/mlk' },
            'SXP': { name: 'ì†”ë¼', logo: 'https://cryptoicon-api.pages.dev/api/icon/sxp' },
            'VTHO': { name: 'ë¹„í† ë¥´í† í°', logo: 'https://cryptoicon-api.pages.dev/api/icon/vtho' },
            'KITE': { name: 'ì¹´ì´íŠ¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/kite' },
            'MINA': { name: 'ë¯¸ë‚˜', logo: 'https://cryptoicon-api.pages.dev/api/icon/mina' },
            'MMT': { name: 'ëª¨ë©˜í…€', logo: 'https://cryptoicon-api.pages.dev/api/icon/mmt' },
            'ZORA': { name: 'ì¡°ë¼', logo: 'https://cryptoicon-api.pages.dev/api/icon/zora' },
            'GAS': { name: 'ê°€ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/gas' },
            'MNT': { name: 'ë§¨í‹€', logo: 'https://cryptoicon-api.pages.dev/api/icon/mnt' },
            'MOC': { name: 'ëª¨ìŠ¤ì½”ì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/moc' },
            'MOODENG': { name: 'ë¬´ë…', logo: 'https://cryptoicon-api.pages.dev/api/icon/moodeng' },
            'XEC': { name: 'ì´ìºì‹œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/xec' },
            'MON': { name: 'ëª¨ë‚˜ë“œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/mon' },
            'ZIL': { name: 'ì§ˆë¦¬ì¹´', logo: 'https://cryptoicon-api.pages.dev/api/icon/zil' },
            'GAME2': { name: 'ê²Œì„ë¹Œë“œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/game2' },
            'STX': { name: 'ìŠ¤íƒìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/stx' },
            'FLOCK': { name: 'í”Œë¡', logo: 'https://cryptoicon-api.pages.dev/api/icon/flock' },
            'PROVE': { name: 'ì„œì‹±íŠ¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/prove' },
            'BSV': { name: 'ë¹„íŠ¸ì½”ì¸ì—ìŠ¤ë¸Œì´', logo: 'https://cryptoicon-api.pages.dev/api/icon/bsv' },
            'SUI': { name: 'ìˆ˜ì´', logo: 'https://cryptoicon-api.pages.dev/api/icon/sui' },
            'SYRUP': { name: 'ë©”ì´í”ŒíŒŒì´ë‚¸ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/syrup' },
            'BTC': { name: 'ë¹„íŠ¸ì½”ì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/btc' },
            'HOLO': { name: 'í™€ë¡œì›”ë“œì—ì´ì•„ì´', logo: 'https://cryptoicon-api.pages.dev/api/icon/holo' },
            'MIRA': { name: 'ë¯¸ë¼ë„¤íŠ¸ì›Œí¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/mira' },
            'SUN': { name: 'ì¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/sun' },
            'ZBT': { name: 'ì œë¡œë² ì´ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/zbt' },
            'ONG': { name: 'ì˜¨í†¨ë¡œì§€ê°€ìŠ¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/ong' },
            'BTT': { name: 'ë¹„íŠ¸í† ë ŒíŠ¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/btt' },
            'ENSO': { name: 'ì—”ì†Œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/enso' },
            'ONT': { name: 'ì˜¨í†¨ë¡œì§€', logo: 'https://cryptoicon-api.pages.dev/api/icon/ont' },
            'SOMI': { name: 'ì†œë‹ˆì•„', logo: 'https://cryptoicon-api.pages.dev/api/icon/somi' },
            'DEEP': { name: 'ë”¥ë¶', logo: 'https://cryptoicon-api.pages.dev/api/icon/deep' },
            'STRAX': { name: 'ì €íŠ¸ë¼', logo: 'https://cryptoicon-api.pages.dev/api/icon/strax' },
            'ICX': { name: 'ì•„ì´ì½˜', logo: 'https://cryptoicon-api.pages.dev/api/icon/icx' },
            'POLYX': { name: 'í´ë¦¬ë§¤ì‰¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/polyx' }
        };

        // Get coin info with fallback
        function getCoinInfo(coin) {
            const upperCoin = coin.toUpperCase();
            if (COIN_INFO[upperCoin]) {
                return COIN_INFO[upperCoin];
            }
            // Fallback: use first letter as placeholder
            return {
                name: coin,
                logo: `https://cryptoicon-api.pages.dev/api/icon/${coin.toLowerCase()}`
            };
        }

        // State
        let currentPage = 1;
        let perPage = 50;
        let filters = {};

        // Initialize function
        function init() {
            console.log('[SurgeHistory] Initializing...');

            // Check admin auth
            if (!window.api.isAuthenticated()) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = '/login.html';
                return;
            }

            // Load initial data
            loadMarkets();
            loadData();
        }

        // Execute immediately if DOM is already loaded (for dynamic page loading),
        // or wait for DOMContentLoaded (for direct page access)
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            // For dynamic page loading, wait for DOM to be fully rendered
            // Try multiple times with increasing delay
            let retryCount = 0;
            const maxRetries = 5;

            function tryInit() {
                // Check for all critical DOM elements
                const filterMarket = document.getElementById('filter-market');
                const tableContent = document.getElementById('table-content');
                const statTotal = document.getElementById('stat-total');
                const statAutoTraded = document.getElementById('stat-auto-traded');

                if (filterMarket && tableContent && statTotal && statAutoTraded) {
                    // DOM is ready, run init
                    console.log('[SurgeHistory] DOM ready, initializing...');
                    init();
                } else {
                    if (retryCount < maxRetries) {
                        retryCount++;
                        console.log(`[SurgeHistory] DOM not ready (filterMarket: ${!!filterMarket}, tableContent: ${!!tableContent}, statTotal: ${!!statTotal}, statAutoTraded: ${!!statAutoTraded}), retrying (${retryCount}/${maxRetries})...`);
                        setTimeout(tryInit, 200 * retryCount); // Increase delay: 200ms, 400ms, 600ms, 800ms, 1000ms
                    } else {
                        console.error('[SurgeHistory] DOM elements not found after retries');
                        console.error(`  - filterMarket: ${!!filterMarket}`);
                        console.error(`  - tableContent: ${!!tableContent}`);
                        console.error(`  - statTotal: ${!!statTotal}`);
                        console.error(`  - statAutoTraded: ${!!statAutoTraded}`);
                    }
                }
            }

            tryInit();
        }

        // Load available markets
        async function loadMarkets() {
            console.log('[SurgeHistory] Loading markets...');
            try {
                const url = `${window.location.origin}/api/admin/surge-history/markets`;
                console.log('[SurgeHistory] Fetching markets:', url);

                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                        'Content-Type': 'application/json'
                    }
                });

                console.log('[SurgeHistory] Markets response status:', response.status);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('[SurgeHistory] Markets error:', errorText);
                    throw new Error('Failed to load markets');
                }

                const data = await response.json();
                console.log('[SurgeHistory] Markets loaded:', data.markets.length, 'markets');

                const marketSelect = document.getElementById('filter-market');
                if (!marketSelect) {
                    console.error('[SurgeHistory] filter-market element not found');
                    return;
                }

                data.markets.forEach(m => {
                    const option = document.createElement('option');
                    option.value = m.market;
                    option.textContent = `${m.market} (${m.count})`;
                    marketSelect.appendChild(option);
                });
            } catch (error) {
                console.error('[SurgeHistory] Failed to load markets:', error);
            }
        }

        // Load data
        async function loadData() {
            console.log('[SurgeHistory] Loading data...');
            try {
                const params = new URLSearchParams({
                    page: currentPage,
                    per_page: perPage,
                    ...filters
                });

                const url = `${window.location.origin}/api/admin/surge-history?${params}`;
                console.log('[SurgeHistory] Fetching:', url);

                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                        'Content-Type': 'application/json'
                    }
                });

                console.log('[SurgeHistory] Response status:', response.status);

                if (!response.ok) {
                    if (response.status === 401 || response.status === 403) {
                        alert('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
                        window.location.href = '/dashboard.html';
                        return;
                    }
                    const errorText = await response.text();
                    console.error('[SurgeHistory] Error response:', errorText);
                    throw new Error(`Failed to load data: ${response.status}`);
                }

                const data = await response.json();
                console.log('[SurgeHistory] Data loaded:', data);

                // Update stats
                updateStats(data.stats);

                // Update table
                updateTable(data.data);

                // Update pagination
                updatePagination(data.pagination);

                console.log('[SurgeHistory] UI updated successfully');

            } catch (error) {
                console.error('[SurgeHistory] Failed to load data:', error);
                showError('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // Update stats
        function updateStats(stats) {
            const statTotal = document.getElementById('stat-total');
            const statAutoTraded = document.getElementById('stat-auto-traded');
            const statConfidence = document.getElementById('stat-confidence');
            const profitEl = document.getElementById('stat-profit');
            const statProfitable = document.getElementById('stat-profitable');
            const statLosing = document.getElementById('stat-losing');

            if (!statTotal || !statAutoTraded || !statConfidence || !profitEl || !statProfitable || !statLosing) {
                console.error('[SurgeHistory] Stats elements not found');
                return;
            }

            statTotal.textContent = stats.total_alerts.toLocaleString();
            statAutoTraded.textContent = stats.auto_traded_count.toLocaleString();
            statConfidence.textContent = (stats.avg_confidence * 100).toFixed(1);

            const profit = stats.total_profit_loss;
            profitEl.textContent = Math.abs(profit).toLocaleString();
            profitEl.style.color = profit >= 0 ? '#10b981' : '#ef4444';

            statProfitable.textContent = stats.profitable_trades.toLocaleString();
            statLosing.textContent = stats.losing_trades.toLocaleString();
        }

        // Update table
        function updateTable(data) {
            const tableContent = document.getElementById('table-content');

            if (data.length === 0) {
                tableContent.innerHTML = `
                    <div class="error-state">
                        <h3>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>í•„í„° ì¡°ê±´ì„ ë³€ê²½í•´ë³´ì„¸ìš”.</p>
                    </div>
                `;
                return;
            }

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>ë§ˆì¼“</th>
                            <th>ì‹ ë¢°ë„</th>
                            <th>ì§„ì…ê°€</th>
                            <th>ëª©í‘œê°€</th>
                            <th>ì†ì ˆê°€</th>
                            <th>ìƒíƒœ</th>
                            <th>ì†ìµ</th>
                            <th>ë°œì†¡ì‹œê°„</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach(alert => {
                const confidence = (alert.confidence * 100).toFixed(1);
                const profitLoss = alert.profit_loss || 0;
                const profitLossPercent = alert.profit_loss_percent ? alert.profit_loss_percent.toFixed(2) : '0.00';

                // Get coin info
                const coinInfo = getCoinInfo(alert.coin);

                // Status badge color and text
                let statusBadge = 'badge-secondary';
                let statusText = 'N/A';
                let statusIcon = '';

                if (alert.status === 'win') {
                    statusBadge = 'badge-success';
                    statusText = 'ìˆ˜ìµ';
                    statusIcon = 'âœ…';
                } else if (alert.status === 'lose') {
                    statusBadge = 'badge-danger';
                    statusText = 'ì†ì‹¤';
                    statusIcon = 'âŒ';
                } else if (alert.status === 'pending') {
                    statusBadge = 'badge-info';
                    statusText = 'ì§„í–‰ì¤‘';
                    statusIcon = 'â³';
                } else if (alert.status === 'neutral') {
                    statusBadge = 'badge-secondary';
                    statusText = 'ì¤‘ë¦½';
                    statusIcon = 'âšª';
                } else if (alert.status === 'backtest') {
                    statusBadge = 'badge-warning';
                    statusText = 'ë°±í…ŒìŠ¤íŠ¸';
                    statusIcon = 'ğŸ“Š';
                }

                html += `
                    <tr onclick="viewDetail(${alert.id})" style="cursor: pointer;">
                        <td>${alert.id}</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <img src="${coinInfo.logo}" alt="${alert.coin}"
                                     style="width: 24px; height: 24px; border-radius: 50%;"
                                     onerror="this.style.display='none'">
                                <div>
                                    <strong>${coinInfo.name}</strong>
                                    <div style="font-size: 0.85em; color: #666;">${alert.market}</div>
                                </div>
                            </div>
                        </td>
                        <td>${confidence}%</td>
                        <td>${alert.entry_price ? alert.entry_price.toLocaleString() + 'ì›' : '-'}</td>
                        <td style="color: #10b981; font-weight: 600;">${alert.target_price ? alert.target_price.toLocaleString() + 'ì›' : '-'}</td>
                        <td style="color: #ef4444; font-weight: 600;">${alert.stop_loss_price ? alert.stop_loss_price.toLocaleString() + 'ì›' : '-'}</td>
                        <td>
                            <span class="badge ${statusBadge}">
                                ${statusIcon} ${statusText}
                            </span>
                        </td>
                        <td style="color: ${profitLoss >= 0 ? '#10b981' : '#ef4444'}; font-weight: 600;">
                            ${profitLoss !== 0 ? (profitLoss >= 0 ? '+' : '') + profitLoss.toLocaleString() + 'ì›' : '-'}
                            ${profitLoss !== 0 ? ' (' + (profitLoss >= 0 ? '+' : '') + profitLossPercent + '%)' : ''}
                        </td>
                        <td>${new Date(alert.sent_at).toLocaleString('ko-KR')}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            tableContent.innerHTML = html;
        }

        // Update pagination
        function updatePagination(pagination) {
            const paginationEl = document.getElementById('pagination');

            let html = '';

            // Previous button
            html += `<button class="page-btn" ${pagination.page === 1 ? 'disabled' : ''} onclick="goToPage(${pagination.page - 1})">ì´ì „</button>`;

            // Page numbers
            const startPage = Math.max(1, pagination.page - 2);
            const endPage = Math.min(pagination.total_pages, pagination.page + 2);

            for (let i = startPage; i <= endPage; i++) {
                html += `<button class="page-btn ${i === pagination.page ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
            }

            // Next button
            html += `<button class="page-btn" ${pagination.page === pagination.total_pages ? 'disabled' : ''} onclick="goToPage(${pagination.page + 1})">ë‹¤ìŒ</button>`;

            paginationEl.innerHTML = html;
        }

        // Show error
        function showError(message) {
            const tableContent = document.getElementById('table-content');
            if (!tableContent) {
                console.error('[SurgeHistory] table-content element not found, cannot show error');
                return;
            }
            tableContent.innerHTML = `
                <div class="error-state">
                    <h3>ì˜¤ë¥˜ ë°œìƒ</h3>
                    <p>${message}</p>
                    <button class="btn btn-primary" onclick="loadData()">ë‹¤ì‹œ ì‹œë„</button>
                </div>
            `;
        }

        // Apply filters
        function applyFilters() {
            filters = {};

            const market = document.getElementById('filter-market').value;
            const signalType = document.getElementById('filter-signal-type').value;
            const autoTraded = document.getElementById('filter-auto-traded').value;
            const status = document.getElementById('filter-status').value;
            const startDate = document.getElementById('filter-start-date').value;
            const endDate = document.getElementById('filter-end-date').value;

            if (market) filters.market = market;
            if (signalType) filters.signal_type = signalType;
            if (autoTraded) filters.auto_traded = autoTraded;
            if (status) filters.status = status;
            if (startDate) filters.start_date = startDate;
            if (endDate) filters.end_date = endDate;

            currentPage = 1;
            loadData();
        }

        // Reset filters
        function resetFilters() {
            document.getElementById('filter-market').value = '';
            document.getElementById('filter-signal-type').value = '';
            document.getElementById('filter-auto-traded').value = '';
            document.getElementById('filter-status').value = '';
            document.getElementById('filter-start-date').value = '';
            document.getElementById('filter-end-date').value = '';

            filters = {};
            currentPage = 1;
            loadData();
        }

        // Change per page
        function changePerPage() {
            perPage = parseInt(document.getElementById('per-page').value);
            currentPage = 1;
            loadData();
        }

        // Go to page
        function goToPage(page) {
            currentPage = page;
            loadData();
        }

        function changePerPage() {
            perPage = parseInt(document.getElementById('per-page').value);
            currentPage = 1;
            loadData();
        }

        function resetFilters() {
            document.getElementById('filter-market').value = '';
            document.getElementById('filter-signal-type').value = '';
            document.getElementById('filter-auto-traded').value = '';
            document.getElementById('filter-status').value = '';
            document.getElementById('filter-start-date').value = '';
            document.getElementById('filter-end-date').value = '';
            applyFilters();
        }

        // View detail
        function viewDetail(alertId) {
            // TODO: Implement detail modal
            console.log('View detail for alert:', alertId);
        }

        // Export CSV
        async function exportCSV() {
            try {
                const params = new URLSearchParams(filters);

                const response = await fetch(`${window.location.origin}/api/admin/surge-history/export?${params}`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                    }
                });

                if (!response.ok) throw new Error('Failed to export CSV');

                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `surge_history_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);

                alert('CSV íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('Failed to export CSV:', error);
                alert('CSV ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // Expose functions to global scope for onclick handlers
        window.goToPage = goToPage;
        window.changePerPage = changePerPage;
        window.applyFilters = applyFilters;
        window.resetFilters = resetFilters;
        window.viewDetail = viewDetail;
        window.exportCSV = exportCSV;

    })();
    </script>
</body>
</html>
