<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸‰ë“±ì˜ˆì¸¡ ì´ë ¥ - ì½”ì¸í„ìŠ¤ ê´€ë¦¬ì</title>
    <link rel="stylesheet" href="css/internal-pages.css">
    <style>
        /* Surge History specific styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
        }

        .back-link {
            color: white;
            text-decoration: none;
            font-size: 14px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            transition: background 0.3s;
        }

        .back-link:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Content */
        .content {
            padding: 40px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
        }

        .stat-unit {
            font-size: 16px;
            opacity: 0.8;
            margin-left: 4px;
        }

        /* Filters */
        .filters {
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }

        .filters h3 {
            margin-bottom: 16px;
            color: #333;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-size: 14px;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
        }

        .filter-group select,
        .filter-group input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }

        .filter-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        /* Table */
        .table-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #e9ecef;
        }

        .table-header h3 {
            color: #333;
            font-size: 18px;
        }

        .table-actions {
            display: flex;
            gap: 12px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f8f9fa;
        }

        th {
            padding: 16px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
        }

        td {
            padding: 16px;
            border-top: 1px solid #e9ecef;
            font-size: 14px;
            color: #333;
        }

        tr:hover {
            background: #f8f9fa;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            padding: 24px;
        }

        .page-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .page-btn:hover:not(:disabled) {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .page-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 60px;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #f3f4f6;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Error State */
        .error-state {
            text-align: center;
            padding: 60px 20px;
        }

        .error-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .error-state h3 {
            margin-bottom: 8px;
            color: #333;
        }

        .error-state p {
            color: #666;
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filter-grid {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 12px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š ê¸‰ë“±ì˜ˆì¸¡ ì´ë ¥ ê´€ë¦¬</h1>
            <a href="dashboard.html#admin" class="back-link">â† ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</a>
        </header>

        <div class="content">
            <!-- Statistics Cards -->
            <div class="stats-grid" id="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">ì „ì²´ ì˜ˆì¸¡</div>
                    <div class="stat-value" id="stat-total">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ìë™ê±°ë˜</div>
                    <div class="stat-value" id="stat-auto-traded">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">í‰ê·  ì‹ ë¢°ë„</div>
                    <div class="stat-value" id="stat-confidence">-<span class="stat-unit">%</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ì´ ì†ìµ</div>
                    <div class="stat-value" id="stat-profit">-<span class="stat-unit">ì›</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ìˆ˜ìµ ê±°ë˜</div>
                    <div class="stat-value" id="stat-profitable">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ì†ì‹¤ ê±°ë˜</div>
                    <div class="stat-value" id="stat-losing">-</div>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters">
                <h3>ğŸ” í•„í„°</h3>
                <div class="filter-grid">
                    <div class="filter-group">
                        <label>ë§ˆì¼“</label>
                        <select id="filter-market">
                            <option value="">ì „ì²´</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>ì‹ í˜¸ ìœ í˜•</label>
                        <select id="filter-signal-type">
                            <option value="">ì „ì²´</option>
                            <option value="surge">Surge</option>
                            <option value="breakout">Breakout</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>ìë™ê±°ë˜</label>
                        <select id="filter-auto-traded">
                            <option value="">ì „ì²´</option>
                            <option value="true">ìë™ê±°ë˜</option>
                            <option value="false">ìˆ˜ë™</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>ìƒíƒœ</label>
                        <select id="filter-status">
                            <option value="">ì „ì²´</option>
                            <option value="pending">Pending (ì§„í–‰ì¤‘)</option>
                            <option value="win">Win (ìˆ˜ìµ)</option>
                            <option value="lose">Lose (ì†ì‹¤)</option>
                            <option value="backtest">Backtest (ë°±í…ŒìŠ¤íŠ¸)</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>ì‹œì‘ì¼</label>
                        <input type="date" id="filter-start-date">
                    </div>
                    <div class="filter-group">
                        <label>ì¢…ë£Œì¼</label>
                        <input type="date" id="filter-end-date">
                    </div>
                </div>
                <div class="filter-actions">
                    <button class="btn btn-primary" onclick="applyFilters()">í•„í„° ì ìš©</button>
                    <button class="btn btn-secondary" onclick="resetFilters()">ì´ˆê¸°í™”</button>
                    <button class="btn btn-secondary" onclick="exportCSV()">CSV ë‚´ë³´ë‚´ê¸°</button>
                </div>
            </div>

            <!-- Table -->
            <div class="table-container">
                <div class="table-header">
                    <h3>ê¸‰ë“±ì˜ˆì¸¡ ë‚´ì—­</h3>
                    <div class="table-actions">
                        <select id="per-page" onchange="changePerPage()">
                            <option value="50">50ê°œì”©</option>
                            <option value="100">100ê°œì”©</option>
                            <option value="200">200ê°œì”©</option>
                            <option value="500">500ê°œì”©</option>
                        </select>
                    </div>
                </div>

                <div id="table-content">
                    <!-- Table will be loaded here -->
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>

                <div class="pagination" id="pagination">
                    <!-- Pagination will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Note: api_client.js is already loaded by dashboard.html, no need to load again -->
    <script>
    (function() {
        'use strict';

        // Coin information mapping
        const COIN_INFO = {
            'BTC': { name: 'ë¹„íŠ¸ì½”ì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/btc' },
            'ETH': { name: 'ì´ë”ë¦¬ì›€', logo: 'https://cryptoicon-api.pages.dev/api/icon/eth' },
            'XRP': { name: 'ë¦¬í”Œ', logo: 'https://cryptoicon-api.pages.dev/api/icon/xrp' },
            'ADA': { name: 'ì—ì´ë‹¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/ada' },
            'SOL': { name: 'ì†”ë¼ë‚˜', logo: 'https://cryptoicon-api.pages.dev/api/icon/sol' },
            'DOGE': { name: 'ë„ì§€ì½”ì¸', logo: 'https://cryptoicon-api.pages.dev/api/icon/doge' },
            'DOT': { name: 'í´ì¹´ë‹·', logo: 'https://cryptoicon-api.pages.dev/api/icon/dot' },
            'MATIC': { name: 'í´ë¦¬ê³¤', logo: 'https://cryptoicon-api.pages.dev/api/icon/matic' },
            'AVAX': { name: 'ì•„ë°œë€ì²´', logo: 'https://cryptoicon-api.pages.dev/api/icon/avax' },
            'LINK': { name: 'ì²´ì¸ë§í¬', logo: 'https://cryptoicon-api.pages.dev/api/icon/link' },
        };

        // Get coin info with fallback
        function getCoinInfo(coin) {
            const upperCoin = coin.toUpperCase();
            if (COIN_INFO[upperCoin]) {
                return COIN_INFO[upperCoin];
            }
            // Fallback: use first letter as placeholder
            return {
                name: coin,
                logo: `https://cryptoicon-api.pages.dev/api/icon/${coin.toLowerCase()}`
            };
        }

        // State
        let currentPage = 1;
        let perPage = 50;
        let filters = {};

        // Initialize function
        function init() {
            console.log('[SurgeHistory] Initializing...');

            // Check admin auth
            if (!window.api.isAuthenticated()) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = '/login.html';
                return;
            }

            // Load initial data
            loadMarkets();
            loadData();
        }

        // Execute immediately if DOM is already loaded (for dynamic page loading),
        // or wait for DOMContentLoaded (for direct page access)
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

        // Load available markets
        async function loadMarkets() {
            console.log('[SurgeHistory] Loading markets...');
            try {
                const url = `${window.location.origin}/api/admin/surge-history/markets`;
                console.log('[SurgeHistory] Fetching markets:', url);

                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                        'Content-Type': 'application/json'
                    }
                });

                console.log('[SurgeHistory] Markets response status:', response.status);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('[SurgeHistory] Markets error:', errorText);
                    throw new Error('Failed to load markets');
                }

                const data = await response.json();
                console.log('[SurgeHistory] Markets loaded:', data.markets.length, 'markets');

                const marketSelect = document.getElementById('filter-market');

                data.markets.forEach(m => {
                    const option = document.createElement('option');
                    option.value = m.market;
                    option.textContent = `${m.market} (${m.count})`;
                    marketSelect.appendChild(option);
                });
            } catch (error) {
                console.error('[SurgeHistory] Failed to load markets:', error);
            }
        }

        // Load data
        async function loadData() {
            console.log('[SurgeHistory] Loading data...');
            try {
                const params = new URLSearchParams({
                    page: currentPage,
                    per_page: perPage,
                    ...filters
                });

                const url = `${window.location.origin}/api/admin/surge-history?${params}`;
                console.log('[SurgeHistory] Fetching:', url);

                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                        'Content-Type': 'application/json'
                    }
                });

                console.log('[SurgeHistory] Response status:', response.status);

                if (!response.ok) {
                    if (response.status === 401 || response.status === 403) {
                        alert('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
                        window.location.href = '/dashboard.html';
                        return;
                    }
                    const errorText = await response.text();
                    console.error('[SurgeHistory] Error response:', errorText);
                    throw new Error(`Failed to load data: ${response.status}`);
                }

                const data = await response.json();
                console.log('[SurgeHistory] Data loaded:', data);

                // Update stats
                updateStats(data.stats);

                // Update table
                updateTable(data.data);

                // Update pagination
                updatePagination(data.pagination);

                console.log('[SurgeHistory] UI updated successfully');

            } catch (error) {
                console.error('[SurgeHistory] Failed to load data:', error);
                showError('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // Update stats
        function updateStats(stats) {
            document.getElementById('stat-total').textContent = stats.total_alerts.toLocaleString();
            document.getElementById('stat-auto-traded').textContent = stats.auto_traded_count.toLocaleString();
            document.getElementById('stat-confidence').textContent = (stats.avg_confidence * 100).toFixed(1);

            const profit = stats.total_profit_loss;
            const profitEl = document.getElementById('stat-profit');
            profitEl.textContent = Math.abs(profit).toLocaleString();
            profitEl.style.color = profit >= 0 ? '#10b981' : '#ef4444';

            document.getElementById('stat-profitable').textContent = stats.profitable_trades.toLocaleString();
            document.getElementById('stat-losing').textContent = stats.losing_trades.toLocaleString();
        }

        // Update table
        function updateTable(data) {
            const tableContent = document.getElementById('table-content');

            if (data.length === 0) {
                tableContent.innerHTML = `
                    <div class="error-state">
                        <h3>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>í•„í„° ì¡°ê±´ì„ ë³€ê²½í•´ë³´ì„¸ìš”.</p>
                    </div>
                `;
                return;
            }

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>ë§ˆì¼“</th>
                            <th>ì‹ ë¢°ë„</th>
                            <th>ì§„ì…ê°€</th>
                            <th>ëª©í‘œê°€</th>
                            <th>ì†ì ˆê°€</th>
                            <th>ìƒíƒœ</th>
                            <th>ì†ìµ</th>
                            <th>ë°œì†¡ì‹œê°„</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach(alert => {
                const confidence = (alert.confidence * 100).toFixed(1);
                const profitLoss = alert.profit_loss || 0;
                const profitLossPercent = alert.profit_loss_percent ? alert.profit_loss_percent.toFixed(2) : '0.00';

                // Get coin info
                const coinInfo = getCoinInfo(alert.coin);

                // Status badge color
                let statusBadge = 'badge-secondary';
                let statusText = alert.status || 'N/A';
                if (alert.status === 'win') statusBadge = 'badge-success';
                else if (alert.status === 'lose') statusBadge = 'badge-danger';
                else if (alert.status === 'pending') statusBadge = 'badge-info';
                else if (alert.status === 'backtest') statusBadge = 'badge-warning';

                html += `
                    <tr onclick="viewDetail(${alert.id})" style="cursor: pointer;">
                        <td>${alert.id}</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <img src="${coinInfo.logo}" alt="${alert.coin}"
                                     style="width: 24px; height: 24px; border-radius: 50%;"
                                     onerror="this.style.display='none'">
                                <div>
                                    <strong>${coinInfo.name}</strong>
                                    <div style="font-size: 0.85em; color: #666;">${alert.market}</div>
                                </div>
                            </div>
                        </td>
                        <td>${confidence}%</td>
                        <td>${alert.entry_price ? alert.entry_price.toLocaleString() + 'ì›' : '-'}</td>
                        <td style="color: #10b981; font-weight: 600;">${alert.target_price ? alert.target_price.toLocaleString() + 'ì›' : '-'}</td>
                        <td style="color: #ef4444; font-weight: 600;">${alert.stop_loss_price ? alert.stop_loss_price.toLocaleString() + 'ì›' : '-'}</td>
                        <td>
                            <span class="badge ${statusBadge}">
                                ${statusText}
                            </span>
                        </td>
                        <td style="color: ${profitLoss >= 0 ? '#10b981' : '#ef4444'}; font-weight: 600;">
                            ${profitLoss !== 0 ? (profitLoss >= 0 ? '+' : '') + profitLoss.toLocaleString() + 'ì›' : '-'}
                            ${profitLoss !== 0 ? ' (' + (profitLoss >= 0 ? '+' : '') + profitLossPercent + '%)' : ''}
                        </td>
                        <td>${new Date(alert.sent_at).toLocaleString('ko-KR')}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            tableContent.innerHTML = html;
        }

        // Update pagination
        function updatePagination(pagination) {
            const paginationEl = document.getElementById('pagination');

            let html = '';

            // Previous button
            html += `<button class="page-btn" ${pagination.page === 1 ? 'disabled' : ''} onclick="goToPage(${pagination.page - 1})">ì´ì „</button>`;

            // Page numbers
            const startPage = Math.max(1, pagination.page - 2);
            const endPage = Math.min(pagination.total_pages, pagination.page + 2);

            for (let i = startPage; i <= endPage; i++) {
                html += `<button class="page-btn ${i === pagination.page ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
            }

            // Next button
            html += `<button class="page-btn" ${pagination.page === pagination.total_pages ? 'disabled' : ''} onclick="goToPage(${pagination.page + 1})">ë‹¤ìŒ</button>`;

            paginationEl.innerHTML = html;
        }

        // Show error
        function showError(message) {
            const tableContent = document.getElementById('table-content');
            tableContent.innerHTML = `
                <div class="error-state">
                    <h3>ì˜¤ë¥˜ ë°œìƒ</h3>
                    <p>${message}</p>
                    <button class="btn btn-primary" onclick="loadData()">ë‹¤ì‹œ ì‹œë„</button>
                </div>
            `;
        }

        // Apply filters
        function applyFilters() {
            filters = {};

            const market = document.getElementById('filter-market').value;
            const signalType = document.getElementById('filter-signal-type').value;
            const autoTraded = document.getElementById('filter-auto-traded').value;
            const status = document.getElementById('filter-status').value;
            const startDate = document.getElementById('filter-start-date').value;
            const endDate = document.getElementById('filter-end-date').value;

            if (market) filters.market = market;
            if (signalType) filters.signal_type = signalType;
            if (autoTraded) filters.auto_traded = autoTraded;
            if (status) filters.status = status;
            if (startDate) filters.start_date = startDate;
            if (endDate) filters.end_date = endDate;

            currentPage = 1;
            loadData();
        }

        // Reset filters
        function resetFilters() {
            document.getElementById('filter-market').value = '';
            document.getElementById('filter-signal-type').value = '';
            document.getElementById('filter-auto-traded').value = '';
            document.getElementById('filter-status').value = '';
            document.getElementById('filter-start-date').value = '';
            document.getElementById('filter-end-date').value = '';

            filters = {};
            currentPage = 1;
            loadData();
        }

        // Change per page
        function changePerPage() {
            perPage = parseInt(document.getElementById('per-page').value);
            currentPage = 1;
            loadData();
        }

        // Go to page
        function goToPage(page) {
            currentPage = page;
            loadData();
        }

        function changePerPage() {
            perPage = parseInt(document.getElementById('per-page').value);
            currentPage = 1;
            loadData();
        }

        function resetFilters() {
            document.getElementById('filter-market').value = '';
            document.getElementById('filter-signal-type').value = '';
            document.getElementById('filter-auto-traded').value = '';
            document.getElementById('filter-status').value = '';
            document.getElementById('filter-start-date').value = '';
            document.getElementById('filter-end-date').value = '';
            applyFilters();
        }

        // View detail
        function viewDetail(alertId) {
            // TODO: Implement detail modal
            console.log('View detail for alert:', alertId);
        }

        // Export CSV
        async function exportCSV() {
            try {
                const params = new URLSearchParams(filters);

                const response = await fetch(`${window.location.origin}/api/admin/surge-history/export?${params}`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                    }
                });

                if (!response.ok) throw new Error('Failed to export CSV');

                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `surge_history_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);

                alert('CSV íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('Failed to export CSV:', error);
                alert('CSV ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // Expose functions to global scope for onclick handlers
        window.goToPage = goToPage;
        window.changePerPage = changePerPage;
        window.applyFilters = applyFilters;
        window.resetFilters = resetFilters;
        window.viewDetail = viewDetail;
        window.exportCSV = exportCSV;

    })();
    </script>
</body>
</html>
